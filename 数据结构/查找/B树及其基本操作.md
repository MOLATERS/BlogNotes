---
title: B树及其基本操作
categories:
- 数据结构
- 查找
- 笔记
tags:
- B树
- 查找
mathjax: true
---
<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

# B树及其基本操作

B树，又称为多路平衡查找树，B树中所有结点的孩子个数的最大值称为B树的阶，通常用m表示。一棵m阶B树或为空树，或为满足如下特性的m叉树：

1. 树中每个结点至多有m颗子树，即最多有m-1个关键字。

2. 若根节点不是终端结点，则至少有两棵子树。

3. 除根节点之外左右的非叶结点至少有$\lceil m/2\rceil$颗子树，即至少有$\lceil m/2-1\rceil$个关键字。

4. 所有的叶节点都出现在同一个层次上，并且不带信息（可以视为外部结点或者类似于折半查找判定树的查找失败结点，实际上这些节点不存在，指向这些结点的指针为空）。

5. 所有非叶节点的结构如下：
   $$
   n P_0 K_1 P_1 K_2 P_2 …… K_n P_n
   $$
   其中Ki为结点的关键字，且满足K1<K2<K3<……<Kn;Pi(i=0,1,2,3……n)为指向子树根结点的指针，且指针$P_{i-1}$所☞的子树中所有结点的关键字均小于$K_i$,$P_i$所指的子树中所有结点的关键字均大于$K_i$，$n(\lceil m/2\rceil\leq n \leq m-1)$为结点中关键字的个数。

## B树的高度

若$n\geq 1$,则对任意一棵包含n个关键字、高度为h、阶数为m的B树：

1. 因为B树中每个结点最多有m棵子树，m-1个关键字，所以在一棵高度为h的m阶B树中关键字的个数应该满足$n \leq (m-1)(1+m+m^2+……+m^{h-1})=m^h-1$，因此有：
   $$
   h \geq log_m(n+1)
   $$

2. 若让每个结点中的关键字个数达到最少，那么容纳同样多关键字的B树的高度达到最大。即

   
   $$
   h \leq log_{\lceil m/2\rceil}((n+1)/2)+1
   $$



## B树的查找

与二叉树查找根很相似，只是每个结点都变成了多个关键字的有序表，在每个结点上所做的不是由两个分支而是由多路分支来决定。

B树的查找包含两个基础操作：

1. 在B树中找结点
2. 在结点内找关键字

B-树的查找时间与

- B-树的阶数m（横向查找）
- B-树的高度h（纵向查找）

在B-树上进行查找

- **查找成功**所需要的时间取决于**关键字值所在的层次**
- **查找不成功**所需的时间取决于**树的高度**



## B树的插入

B-树的是从空树起，逐个插入关键字而生成的。

在m阶B-树中，每个非失败结点的关键字个数都在$[\lceil m/2 \rceil -1,m-1]$z之间（根节点：[1,m-1])

插入操作，首先执行查找操作以确定可以插入新关键字的终端节点p.

如果在关键字插入之后，节点中的关键字个数没有超过上界m-1，直接插入写盘；否则（=m），结点需要进行分裂

**实现分裂的原则：**设插入之前终端结点p中已经由m-1个关键字，当再插入一个关键字后结点的状态为$(m,A_0,K_1,A_1,K_2,A_2,……K_m,A_m)$其中$K_i<K_{i+1},i\leq i <m$

这时把结点p分裂为两个结点p和q，它们包含的信息分别为

p:$(\lceil m/2 \rceil-1,A_0,K_1,A_1,……,K_{\lceil m/2\rceil-1},A_{\lceil m/2\rceil-1})$

q:$(m-\lceil m/2 \rceil,A_{\lceil m/2\rceil},K_{\lceil m/2\rceil+1},A_{\lceil m/2\rceil+1,……,K_m,A_m}）$



## B树的删除

B树的删除与插入操作类似，但是还是要复杂一些。要使得删除之后的关键字个数$\geq\lceil m/2\rceil-1$,因此将涉及合并问题。

当被删除关键字k不在终端结点（最底层非叶结点）中时，可以用k的前驱（后继）k'来代替k,然后再相应的结点删除k‘,关键字k'必定落在某个终端结点中，则转换成了被删关键字在终端节点中的情形。

1. 直接删除关键字。如果被删除的关键字所在的结点的关键词字数$\geq\lceil m/2\rceil$,表明删除该关键字无副作用。
2. 兄弟够借。顾名思义。当兄弟够借时，将调整该节点，相邻的兄弟结点和双亲结点（父子换位），以达到新的平衡。
3. 兄弟不够借。顾名思义。此时将关键字删除后与兄弟以及双亲结点中的关键字进行合并。


在合并过程中，双亲节点中的关键字个数会减1，递归的和上方的兄弟结点和双亲结点做出相应的调整直到全部符合要求为止。
